<local1:EntityControlBase x:Class="BookOrg.Src.UI.DBInteraction.Controls.TableInteraction.LoanControl"
                         x:TypeArguments="entities:Loan"
                         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                         xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
                         xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
                         xmlns:local1="clr-namespace:BookOrg.Src.UI.DBInteraction.Controls.TableInteraction"
                         xmlns:entities="clr-namespace:BookOrg.Src.Logic.Core.DBEntities"
                         xmlns:sys="clr-namespace:System;assembly=mscorlib"
                         mc:Ignorable="d" 
                         d:DesignHeight="500" d:DesignWidth="1000">
    
    <Grid Background="#e6e6fa">
        <TabControl Margin="5">
            <TabItem Header="Ongoing Loans">
                <Grid Background="#e6e6fa">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="10">
                        <TextBlock Text="On-going Loans" FontSize="20" FontWeight="Bold" VerticalAlignment="Center"/>
                        <Button Click="AddNewLoanClick" Style="{StaticResource AddButtonStyle}" Margin="20,0,0,0"/>
                    </StackPanel>

                    <DataGrid ItemsSource="{Binding Items}" AutoGenerateColumns="False" CanUserAddRows="False"
                              HeadersVisibility="Column" GridLinesVisibility="Horizontal" Background="White" 
                              RowHeaderWidth="0" Grid.Row="1" FontSize="14" CellEditEnding="DataGridCellEditEnding">
                        <DataGrid.Columns>

                            <DataGridTemplateColumn Header="Customer" Width="*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding CustomerName}" Margin="5"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <ComboBox ItemsSource="{Binding DataContext.AllCustomers, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                  DisplayMemberPath="LastName" 
                                                  SelectedValuePath="ID"
                                                  SelectedValue="{Binding CustomerID, UpdateSourceTrigger=PropertyChanged}"
                                                  SelectionChanged="CustomerSelectionChanged"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Header="Book" Width="200">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding BookTitle}" Margin="5"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <ComboBox ItemsSource="{Binding DataContext.AvailableBooks, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                  DisplayMemberPath="Title" 
                                                  SelectedValuePath="ID"
                                                  SelectedValue="{Binding BookID, UpdateSourceTrigger=PropertyChanged}"
                                                  SelectionChanged="BookSelectionChanged"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTextColumn Header="Price" Binding="{Binding TotalLoanPrice, StringFormat=C, UpdateSourceTrigger=PropertyChanged}" Width="80"/>

                            <DataGridComboBoxColumn Header="Status" SelectedItemBinding="{Binding LoanStatus, UpdateSourceTrigger=PropertyChanged}" Width="100">
                                <DataGridComboBoxColumn.ItemsSource>
                                    <x:Array Type="{x:Type sys:String}">
                                        <sys:String>active</sys:String>
                                        <sys:String>overdue</sys:String>
                                        <sys:String>returned</sys:String>
                                    </x:Array>
                                </DataGridComboBoxColumn.ItemsSource>
                            </DataGridComboBoxColumn>

                            <DataGridTemplateColumn Header="Start Date" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding LoanStartDate, StringFormat=d}" Margin="5"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <DatePicker SelectedDate="{Binding LoanStartDate, UpdateSourceTrigger=PropertyChanged}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Header="Due Date" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding LoanDueDate, StringFormat=d}" Margin="5"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <DatePicker SelectedDate="{Binding LoanDueDate, UpdateSourceTrigger=PropertyChanged}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Width="90">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Click="DeleteLoanClick" Style="{StaticResource RemoveButtonStyle}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <TabItem Header="Returned Loans">
                <Grid Background="#d3d3d3">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="Loan History" FontSize="20" FontWeight="Bold" Margin="10"/>

                    <DataGrid ItemsSource="{Binding ReturnedItems}" AutoGenerateColumns="False" CanUserAddRows="False"
                              IsReadOnly="True" HeadersVisibility="Column" GridLinesVisibility="Horizontal" Background="White" 
                              RowHeaderWidth="0" Grid.Row="1" FontSize="14">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Customer" Binding="{Binding CustomerName}" Width="*"/>
                            <DataGridTextColumn Header="Book" Binding="{Binding BookTitle}" Width="200"/>
                            <DataGridTextColumn Header="Price" Binding="{Binding TotalLoanPrice, StringFormat=C}" Width="80"/>
                            <DataGridTextColumn Header="Status" Binding="{Binding LoanStatus}" Width="80"/>
                            <DataGridTextColumn Header="Start Date" Binding="{Binding LoanStartDate, StringFormat=d}" Width="100"/>
                            <DataGridTextColumn Header="Due Date" Binding="{Binding LoanDueDate, StringFormat=d}" Width="100"/>
                            <DataGridTextColumn Header="Returned Date" Binding="{Binding LoanReturnedDate, StringFormat=d}" Width="100"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</local1:EntityControlBase>